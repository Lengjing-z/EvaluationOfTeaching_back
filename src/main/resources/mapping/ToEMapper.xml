<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.wrrrrrrry.evaluationteaching.mapper.ToEMapper">
    <resultMap id="questionnaire" type="org.wrrrrrrry.evaluationteaching.entity.Questionnaire">
        <id property="id" column="qnid"/>
        <result property="title" column="title"/>
        <result property="indexRootId" column="index_root_id"/>
        <collection property="beEvaUsers" resultMap="beEvauser"/>
        <collection property="evaUsers" resultMap="evauser"/>
    </resultMap>
    <resultMap id="beEvauser" type="org.wrrrrrrry.evaluationteaching.entity.User">
        <id property="id" column="beEvaid"/>
        <result property="name" column="beEvaname"/>
        <result property="code" column="beEvacode"/>
        <collection property="institute" resultMap="beEvainstitute"/>
    </resultMap>
    <resultMap id="evauser" type="org.wrrrrrrry.evaluationteaching.entity.User">
        <id property="id" column="evaid"/>
        <result property="name" column="evaname"/>
        <result property="code" column="evacode"/>
        <collection property="institute" resultMap="evainstitute"/>
    </resultMap>
    <resultMap id="beEvainstitute" type="org.wrrrrrrry.evaluationteaching.entity.Institute">
        <id property="id" column="beEvainid"/>
    </resultMap>
    <resultMap id="evainstitute" type="org.wrrrrrrry.evaluationteaching.entity.Institute">
        <id property="id" column="evainid"/>
    </resultMap>
    <insert id="insertStudentAnswer">

    </insert>
    <insert id="insertTeacherAnswer"></insert>
    <select id="selectStudentFinishedQuestionnaire" resultMap="questionnaire">
        select qn.id as qnid, title, index_root_id,
               u.id as beEvaid, u.name as beEvaname, u.in_id as beEvainid, u.code as beEvacode,
               u1.id as evaid, u1.name as evaname, u1.in_id as evainid, u1.code as evacode
        from questionnaire qn
        left join studentToteacher sT on qn.id = sT.qn_id
        left join message m on sT.id = m.stt_id
        left join user u on m.target_id = u.id
        left join user u1 on m.u_id = u1.id
        where u1.code = #{code} and is_finished = true
    </select>
    <select id="selectTeacherFinishedQuestionnaire" resultMap="questionnaire">
        select qn.id as qnid, title, index_root_id,
               u.id as beEvaid, u.name as beEvaname, u.in_id as beEvainid, u.code as beEvacode,
               u1.id as evaid, u1.name as evaname, u1.in_id as evainid, u1.code as evacode
        from questionnaire qn
        left join teacherToteacher tT on qn.id = tT.qn_id
        left join message m on tT.id = m.ttt_id
        left join user u on m.target_id = u.id
        left join user u1 on m.u_id = u1.id
        where u1.code = #{code} and is_finished = true
    </select>
    <select id="selectStudentFinishedDetailById" resultType="java.util.Map">
        select content as content, answer as answer from question
        left join questionnaire q on question.qn_id = q.id
        left join student_answer sa on question.id = sa.q_id
        where q.id=#{id}
    </select>
    <select id="selectTeacherFinishedDetailById" resultType="java.util.Map">
        select content as content, answer as answer from question
        left join questionnaire q on question.qn_id = q.id
        left join teacher_answer ta on question.id = ta.q_id
        where q.id=#{id}
    </select>
    <select id="selectStudentProgressingQuestionnaire" resultMap="questionnaire">
        select qn.id as qnid, title, index_root_id,
               u.id as beEvaid, u.name as beEvaname, u.in_id as beEvainid, u.code as beEvacode,
               u1.id as evaid, u1.name as evaname, u1.in_id as evainid, u1.code as evacode
        from questionnaire qn
        left join studentToteacher sT on qn.id = sT.qn_id
        left join message m on sT.id = m.stt_id
        left join user u on m.target_id = u.id
        left join user u1 on m.u_id = u1.id
        where u1.code = #{code} and is_finished = false
    </select>
    <select id="selectTeacherProgressingQuestionnaire" resultMap="questionnaire">
        select qn.id as qnid, title, index_root_id,
               u.id as beEvaid, u.name as beEvaname, u.in_id as beEvainid, u.code as beEvacode,
               u1.id as evaid, u1.name as evaname, u1.in_id as evainid, u1.code as evacode
        from questionnaire qn
        left join teacherToteacher tT on qn.id = tT.qn_id
        left join message m on tT.id = m.ttt_id
        left join user u on m.target_id = u.id
        left join user u1 on m.u_id = u1.id
        where u1.code = #{code} and is_finished = false
    </select>
    <select id="selectStudentProgressingDetailById"
            resultType="org.wrrrrrrry.evaluationteaching.entity.Question">
        select id, content, qn_id, index_end_id
        from question
        where qn_id = #{id};
    </select>
    <select id="selectTeacherProgressingDetailById"
            resultType="org.wrrrrrrry.evaluationteaching.entity.Question">
        select id, content, qn_id, index_end_id
        from question
        where qn_id = #{id};
    </select>
</mapper>